<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.twogap.project.visitor.model.mapper.VisitorMapper">

	<resultMap type="Visitor" id="visitor_rm">
		
		<id property="memberNo" column="MEMBER_NO"/>
		
		<association
			property="visitorMember"
			column="MEMBER_NO"
			javaType="com.twogap.project.member.model.dto.Member"
			select="visitorProfile"
		/>
	</resultMap>
	
	<select id="getVisitorListCount">
		SELECT COUNT(*) FROM "VISITOR"
		JOIN "MEMBER" ON("MEMBER".MEMBER_NO = "VISITOR".MEMBER_NO)
		WHERE HOST_MEMBER_NO = #{memberNo}
		AND MEMBER_DEL_FL = 'N'
	</select>
	
	
	<select id="selectList" resultMap="visitor_rm">
		SELECT 

			VISITOR_NO, 
			VISITOR_CONTENT,
			TO_CHAR(VISITOR_DATE, 'MM.DD') "VISITOR_DATE",
			TO_CHAR(VISITOR_UPDATE_DATE, 'MM.DD') "VISITOR_DATE",
			V.MEMBER_NO,
			BOARD_TYPE_NO,
			HOST_MEMBER_NO
			
		FROM VISITOR V
		JOIN "MEMBER" M ON(M.MEMBER_NO = V.MEMBER_NO)
		WHERE HOST_MEMBER_NO = #{memberNo}
		AND MEMBER_DEL_FL = 'N'
		ORDER BY 1 DESC
	</select>
	
	
	<select id="visitorProfile" resultType="Member">
		SELECT
			MEMBER_NO,
			PROFILE_IMG ,
			MEMBER_NICKNAME
			
		FROM "MEMBER"
		WHERE MEMBER_NO = #{memberNo}
	</select>
	
	<insert id="visitorInsert">
		INSERT INTO "VISITOR" VALUES (
			VISITOR_SEQ.NEXTVAL,
			#{visitorContent},
			DEFAULT,
			NULL,
			#{memberNo},
			DEFAULT,
			#{hostMemberNo}
		)
	</insert>
	
	<update id="visitorUpdate">
		UPDATE "VISITOR" SET
		VISITOR_CONTENT = #{visitorContent}
		WHERE VISITOR_NO = #{visitorNo}
		AND BOARD_TYPE_NO = 3
	</update>
	
	<delete id="visitorDelete">
		DELETE FROM "VISITOR"
		WHERE VISITOR_NO = #{visitorNo}
		AND BOARD_TYPE_NO = 3
	</delete>
	
	
</mapper>