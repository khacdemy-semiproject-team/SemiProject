<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="com.twogap.project.photo.model.mapper.PhotoMapper">




	<!-- photo insert -->
	<insert id="photoInsert" useGeneratedKeys="true"
		parameterType="Photo">
		<selectKey order="BEFORE" resultType="_int"
			keyProperty="photoNo">
			SELECT PHOTO_SEQ.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO "PHOTO" VALUES(
		#{photoNo},
		#{photoTitle},
		DEFAULT,
		NULL,
		#{memberNo},
		DEFAULT
		)

	</insert>


	<!-- Photo Img DB 정보 저장 -->
	<insert id="photoInsertUploadList" parameterType="list">
		INSERT INTO "IMG"

		<foreach collection="list" item="img" open="(" close=")"
			separator=" UNION ">
			SELECT
			NEXT_IMG_NO(),
			#{img.imgPath},
			#{img.imgOriginalName},
			#{img.imgRename},
			#{img.imgOrder},
			#{img.imgBoardNo},
			#{img.boardTypeNo}
			FROM DUAL


		</foreach>

	</insert>

	<!-- photoList 조회용 쿼리 -->
	<select id="photoSelectList">
		SELECT 
				PHOTO_NO,
				PHOTO_TITLE,
				TO_CHAR(PHOTO_DATE, 'YYYY-MM-DD HH24:MI:SS') "PHOTO_DATE",
				TO_CHAR(PHOTO_UPDATE_DATE, 'YYYY-MM-DD HH24:MI:SS') "PHOTO_UPDATE_DATE",
				PHOTO.MEMBER_NO,
				PHOTO.BOARD_TYPE_NO,
				IMG_PATH, 
				IMG_ORIGINAL_NAME, 
				IMG_RENAME,
				IMG_NO
			FROM "PHOTO" JOIN "IMG" 
			ON IMG.IMG_BOARD_NO = PHOTO.PHOTO_NO
			WHERE PHOTO.MEMBER_NO = #{memberNo}
			AND IMG.BOARD_TYPE_NO = 2
			ORDER BY IMG_NO DESC
	</select>
	
	<!-- 사진 삭제 -->
	<delete id="photoDelete">
		DELETE FROM IMG
		WHERE IMG_NO = #{imgNo}
	</delete>
	
	<!-- 사진 업데이트 -->
	<update id="photoUpdate">
		UPDATE PHOTO 
		SET 
		PHOTO_TITLE = #{photoTitle},
		PHOTO_UPDATE_DATE = SYSDATE
		WHERE PHOTO_NO = #{photoNo}
	</update>
	
	<!--  img 업데이트  -->
	<update id="photoUploadList">
		UPDATE IMG
		SET 
		IMG_PATH = #{imgPath},
		IMG_ORIGINAL_NAME = #{imgOriginalName},
		IMG_RENAME = #{imgRename},
		IMG_BOARD_NO = #{imgBoardNo}
		WHERE 
		IMG_NO = #{imgNo}
		
	</update>
	
	<update id="photoTitleUpdate">
	UPDATE PHOTO 
	SET
	PHOTO_TITLE = #{photoTitle}
	WHERE PHOTO_NO = #{photoNo}
	</update>


	<!-- 게시글 수 세기 -->
	<!-- <select id="getPhotoListCount">
		SELECT COUNT(*) FROM "PHOTO"
		WHERE MEMBER_NO =
		#{memberNo}
	</select> -->


</mapper>